<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
          --fret-width: 40px;
          --fret-height: 80px;
          --string-width: 2px;
          display: flex;
          justify-content: center;
          margin: 0;
          background: #333;
        }
    </style>
</head>
<body>
  <my-guitar></my-guitar>

  <script>
    class Guitar extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.innerHTML = `
          <style>
            :host {
              display: flex;
              justify-content: center;
            }
          </style>`;
        
        const frequencies = [ 329.63, 440, 587.33, 783.99, 987.77, 1318.51 ];

        frequencies.forEach(note => this.shadowRoot.innerHTML += `<guitar-string open="${note}"></string>`);
      }
    }
    customElements.define('my-guitar', Guitar);

    class String extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.innerHTML = `
          <style>
            .string {
              height: 100vh;
              width: var(--string-width);
              background: silver;
              margin: 0 calc((var(--fret-width) - var(--string-width)) / 2);
            }
          </style>
          <div class="string"></div>`;

        this.openNote = this.attributes.open.value;
        
        this.audioContext = new AudioContext();

        this.addEventListener('touchstart', () => {
          this.oscillator = this.audioContext.createOscillator();
          this.oscillator.frequency.value = this.openNote;
          this.oscillator.connect(this.audioContext.destination);
          this.oscillator.start();
        });
        this.addEventListener('touchend', () => {
          this.oscillator.stop();
        })

      }

      connectedCallback() {
        const height = window.innerHeight;
        const fretHeight = document.body.computedStyleMap().get('--fret-height').toString().trim().replace('px', '');  
        const numberOfFrets = Math.ceil(height / fretHeight);

        const string = this.shadowRoot.querySelector('.string');

        for (let i = 1; i <= numberOfFrets; i++) {    
          string.innerHTML += `<guitar-fret></guitar-fret>`;
        }
      
      }
    }
    customElements.define('guitar-string', String);

    class Fret extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });

        this.shadowRoot.innerHTML = `
          <style>
            .fret {
              background: none;
              border: none;
              padding: 0;
              border-bottom: 2px solid #888;
              width: var(--fret-width);
              margin-left: calc(var(--fret-width) / -2);
              height: var(--fret-height);
            }
            .fret:focus, .fret:active {
              outline: none;
            }
            .fret.active {
              background: #ddd;
            }
          </style>
          <button class="fret"></button>`;

        this.button = this.shadowRoot.querySelector('button');
        this.button.addEventListener('touchstart', () => this.pressed = true);
        this.button.addEventListener('touchend', () => this.pressed = false);
        this.button.addEventListener('contextmenu', event => event.preventDefault());
      }
    }
    customElements.define('guitar-fret', Fret);
  </script>
</body>
</html>